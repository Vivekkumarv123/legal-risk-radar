<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Legal Risk Radar - Extension Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-section {
            margin: 30px 0;
            padding: 20px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
        }
        .legal-text {
            background: #f9fafb;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
            border-left: 4px solid #3b82f6;
        }
        .instructions {
            background: #fef3c7;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
            border-left: 4px solid #f59e0b;
        }
    </style>
</head>
<body>
    <h1>üîç Legal Risk Radar - Extension Test Page</h1>
    
    <div class="instructions">
        <h3>üìã How to Test the Extension:</h3>
        <ol>
            <li>Select any legal text below</li>
            <li>Click the extension icon in your browser toolbar</li>
            <li>Click "Analyze Selected Text" in the popup</li>
            <li>Check the console for any errors</li>
        </ol>
        
        <h4>üåê Production Mode:</h4>
        <p>The extension is now configured to use the deployed server at <code>https://legal-risk-radar.vercel.app</code>. This should work from any website without CORS issues.</p>
    </div>

    <div class="test-section">
        <h2>Test Case 1: Simple Contract Clause</h2>
        <div class="legal-text">
            The Company shall indemnify and hold harmless the Client from any and all claims, damages, losses, and expenses arising out of the Company's performance of this Agreement. This indemnification shall survive termination of this Agreement.
        </div>
    </div>

    <div class="test-section">
        <h2>Test Case 2: High-Risk Terms</h2>
        <div class="legal-text">
            The Client waives all rights to pursue legal action against the Company for any reason whatsoever. The Company shall not be liable for any damages, including but not limited to direct, indirect, incidental, punitive, or consequential damages. This Agreement shall be governed by the laws of an undisclosed jurisdiction.
        </div>
    </div>

    <div class="test-section">
        <h2>Test Case 3: Employment Terms</h2>
        <div class="legal-text">
            Employee agrees to work exclusively for the Company and shall not engage in any other employment or business activities without prior written consent. Employee acknowledges that all work product created during employment belongs solely to the Company. Upon termination, Employee shall return all Company property and shall not compete with the Company for a period of two years.
        </div>
    </div>

    <div class="test-section">
        <h2>Test Case 4: Privacy Policy</h2>
        <div class="legal-text">
            We collect personal information including but not limited to your name, email address, phone number, location data, browsing history, and financial information. We may share this information with third parties for marketing purposes. By using our service, you consent to the collection and use of your personal information as described in this policy.
        </div>
    </div>

    <script>
        // Add some debugging
        console.log('Legal Risk Radar Test Page: Loaded');
        
        // Listen for selection changes
        document.addEventListener('selectionchange', function() {
            const selection = window.getSelection();
            const selectedText = selection.toString().trim();
            if (selectedText.length > 0) {
                console.log('Legal Risk Radar Test: Text selected, length:', selectedText.length);
                console.log('Selected text:', selectedText.substring(0, 100) + '...');
            }
        });
        
        // Test extension communication
        window.addEventListener('message', function(event) {
            console.log('Legal Risk Radar Test: Received message:', event.data);
        });

        // Add a test button to trigger analysis directly
        document.addEventListener('DOMContentLoaded', function() {
            const testButton = document.createElement('button');
            testButton.textContent = 'üß™ Test Direct Analysis';
            testButton.style.cssText = `
                position: fixed;
                top: 10px;
                right: 10px;
                background: #3b82f6;
                color: white;
                border: none;
                padding: 10px 15px;
                border-radius: 6px;
                cursor: pointer;
                font-weight: 600;
                z-index: 1000;
            `;
            
            testButton.addEventListener('click', async function() {
                const testText = "The Company shall not be liable for any damages whatsoever, including but not limited to direct, indirect, incidental, punitive, or consequential damages. The Client waives all rights to pursue legal action.";
                
                console.log('Testing CORS with preflight request...');
                
                try {
                    // First test OPTIONS request (preflight)
                    const optionsResponse = await fetch('https://legal-risk-radar.vercel.app/api/analyze', {
                        method: 'OPTIONS',
                        headers: {
                            'Content-Type': 'application/json',
                        }
                    });
                    
                    console.log('OPTIONS response:', optionsResponse.status, optionsResponse.headers);
                    
                    // Then test actual POST request
                    const response = await fetch('https://legal-risk-radar.vercel.app/api/analyze', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ 
                            text: testText,
                            source: 'test_page'
                        }),
                        mode: 'cors'
                    });
                    
                    console.log('POST response status:', response.status);
                    console.log('POST response headers:', [...response.headers.entries()]);
                    
                    if (response.ok) {
                        const result = await response.json();
                        console.log('Direct API test successful:', result);
                        alert('‚úÖ Direct API test successful! CORS is working. Check console for details.');
                    } else {
                        const errorText = await response.text();
                        console.error('Direct API test failed:', response.status, errorText);
                        alert(`‚ùå Direct API test failed (${response.status}). Check console for details.`);
                    }
                } catch (error) {
                    console.error('Direct API test error:', error);
                    if (error.name === 'TypeError' && error.message.includes('fetch')) {
                        alert('‚ùå CORS error or connection failed. Make sure the deployed server is accessible.');
                    } else {
                        alert(`‚ùå Connection error: ${error.message}`);
                    }
                }
            });
            
            document.body.appendChild(testButton);
        });
    </script>
</body>
</html>